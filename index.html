<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Cute Class</title>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
</head>
<body>
<nav class="navbar navbar-expand-md navbar-dark bg-dark mb-3">
    <div class="container-fluid">
        <a href="#" class="navbar-brand mr-3">Tutorial Republic</a>
        <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbarCollapse">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarCollapse">
            <div class="navbar-nav">
                <a href="#" class="nav-item nav-link active">Home</a>                
            </div>
            <div class="navbar-nav ml-auto">
                <a href="#" class="nav-item nav-link">Register</a>
                <a href="#" class="nav-item nav-link">Login</a>
            </div>
        </div>
    </div>    
</nav>
<div class="container">
    <div id="videorecorder">
      <video id="viredemovideoele"></video>
      <span style="font-size:20px;" id="countdown"></span>
    </div>
 
    <input id="playback" value="PlayBack" type="button"/>
    <input id="clearrecording" value="Clear Recording" type="button"/>
    <input id="startRecrodBut1" value="Start Recording" type="button"/>
    <input id="stopRecBut1" value="Stop Recording" type="button"/>
    <input id="uploadrecord" value="Upload Recording" type="button"/>
 
 
    </br>
    <p id="status"></p>
    <video id="recordedvideo" controls></video>
    <audio id="audiored" controls></audio>
    <a id="downloadurl">Download</a>
    <div id="progressNumber" style="font-size:20px;"></div>
 
    <script src="./js/VideoRecorderJS.js" type="text/javascript"></script>
 
    <script type="text/javascript"> 
        var startRecord = document.getElementById("startRecrodBut1");
        var stopRecord = document.getElementById("stopRecBut1");
        var countdownElement = document.getElementById("countdown");
        var playBackRecord = document.getElementById("playback");
        var discardRecordng = document.getElementById("clearrecording");
        var uploadrecording = document.getElementById("uploadrecord");
        var progressNumber = document.getElementById("progressNumber");   
    
        var virec = new VideoRecorderJS.init(
                {
                    resize: 0.8, // recorded video dimentions are 0.4 times smaller than the original
                    webpquality: 0.5, // chrome and opera support webp imags, this is about the aulity of a frame
                    framerate: 15,  // recording frame rate
                    videotagid: "viredemovideoele",
                    videoWidth: "640",
                    videoHeight: "480",
                    log: true,
                    mediaRecorderType : "webscript",
                    workerPath : "./js/recorderWorker.js"
                },
                function () {
                    //success callback. this will fire if browsers supports
                },
                function (err) {
                    //onerror callback, this will fire for mediaErrors
                    if (err.name == "BROWSER_NOT_SUPPORTED") {
                        //handler code goes here
                    } else if (err.name == "PermissionDeniedError") {
                        //handler code goes here
                    } else if (err.name == "NotFoundError") {
                        //handler code goes here
                    } else {
                        throw 'Unidentified Error.....';
                    }
    
                }
        );
    
        startRecord.addEventListener("click", function () {
            virec.startCapture(); // this will start recording video and the audio
            stopCountDown();
            startCountDown();
        });
    
        stopRecord.addEventListener("click", function () {
            /*
            stops the recording and after recording is finalized oncaptureFinish call back
            will occur
            */
            virec.stopCapture(oncaptureFinish);
            stopCountDown();
        });
    
        playBackRecord.addEventListener("click", function () {
            /*
            Clientside playback,
            */
            virec.play();
        });
    
        discardRecordng.addEventListener("click", function () {
            /*
            Clears the current recorded video + audio allowing
            another recording to happen
            */
            virec.clearRecording();
            stopCountDown();
        });
    
        uploadrecording.addEventListener("click", function () {
            /*
            Uploading the content to the server, here I have sliced the blobs into chunk size
            of 1048576 bits so that uploading time will reduce.
            Gmail uses this same technique when we attach some files to a mail, it slize the file
            in the client side and then uploads chunk by chunk
            */
            var uploadoptions = {
                blobchunksize: 1048576,
                requestUrl: "php/fileupload.php",
                requestParametername: "filename",
                videoname: "video.webm",
                audioname: "audio.wav"
            };
            virec.uploadData(uploadoptions, function (totalchunks, currentchunk) {
                /*
                This function will callback during, each successfull upload of a blob
                so you can use this to show a progress bar or something
                */
                progressNumber.innerHTML = ((currentchunk / totalchunks) * 100);
                console.log(currentchunk + " OF " + totalchunks);
            });
        });
    
    
        //------------------------------- few functions that demo, how to play with the api --------------------------
    
        var countdowntime = 15;
        var functioncalltime = 0;
        var timerInterval = null;
    
        function oncaptureFinish(result) {
            document.getElementById('status').innerHTML = "";
            result.forEach(function (item) {
                if (item.type == "video") {
                    var videoblob = item.blob;
                    var videobase64 = window.URL.createObjectURL(videoblob);
                    document.getElementById('recordedvideo').src = videobase64;
                    document.getElementById('downloadurl').style.display = '';
                    document.getElementById('downloadurl').href = videobase64;
                    document.getElementById('status').innerHTML = document.getElementById('status').innerHTML + "video=" + Math.ceil(videoblob.size / (1024)) + "KB";
    
                } else if (item.type == "audio") {
                    var audioblob = item.blob;
                    document.getElementById('audiored').src = window.URL.createObjectURL(audioblob);
                    document.getElementById('status').innerHTML = document.getElementById('status').innerHTML + "Audio=" + Math.ceil(audioblob.size / (1024)) + "KB";
                }
            });
        }
    
        function setCountDownTime(time) {
            countdownElement.innerHTML = time;
            return time;
        }
    
    
        function startCountDown() {
            if (timerInterval == null) {
                functioncalltime = countdowntime;
                var value = setCountDownTime(functioncalltime);
                timerInterval = setInterval(function () {
                    var value = setCountDownTime(--functioncalltime);
                    if (value == 0) {
                        clearInterval(timerInterval);
                        virec.stopCapture(oncaptureFinish);
                    }
                }, 1000);
            }
        }
    
        function stopCountDown() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }
    
    
    </script>
  
    
    <hr>
    <footer>
        <div class="row">
            <div class="col-md-6">
                <p>Copyright &copy; 2019 Tutorial Republic</p>
            </div>
            <!--
            <div class="col-md-6 text-md-right">
                <a href="#" class="text-dark">Terms of Use</a> 
                <span class="text-muted mx-2">|</span> 
                <a href="#" class="text-dark">Privacy Policy</a>
            </div>
            -->
        </div>
    </footer>
</div>
</body>
</html>                            
